<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sudoku - Medium</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #232837;
      color: #fff;
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 520px;
      margin: 40px auto;
      padding: 32px 24px;
      background: #232837;
      border-radius: 16px;
      box-shadow: 0 10px 32px rgba(0,0,0,0.4);
      text-align: center;
    }
    h1 {
      margin-bottom: 24px;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .button-row {
      margin-bottom: 24px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    .btn {
      font-size: 1rem;
      padding: 8px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s, color 0.2s, border 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn.blue {
      background: #3a5afe;
      color: #fff;
    }
    .btn.yellow {
      background: #232837;
      border: 2px solid #fbbf24;
      color: #fbbf24;
    }
    .btn.green {
      background: #232837;
      border: 2px solid #22c55e;
      color: #22c55e;
    }
    .btn.blue-outline {
      background: #232837;
      border: 2px solid #3a5afe;
      color: #3a5afe;
    }
    .sudoku-board {
      display: grid;
      grid-template-columns: repeat(9, 40px);
      grid-template-rows: repeat(9, 40px);
      gap: 0;
      justify-content: center;
      margin: 0 auto 24px auto;
      background: #232837;
      border-radius: 8px;
      border: 2px solid #444;
      width: fit-content;
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #232837;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      border: 1px solid #444;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    .cell.selected {
      background: #3a5afe;
    }
    .cell.fixed {
      color: #bbb;
      font-weight: bold;
      cursor: default;
      background: #232837;
    }
    .cell.box-right {
      border-right: 3px solid #444;
    }
    .cell.box-bottom {
      border-bottom: 3px solid #444;
    }
    .number-pad {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      gap: 8px;
      justify-content: center;
      margin-top: 16px;
    }
    .number-pad button {
      font-size: 1.1rem;
      padding: 12px 0;
      background: #232837;
      color: #fff;
      border: 1.5px solid #444;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      font-family: inherit;
    }
    .number-pad button:hover {
      background: #3a5afe;
      color: #fff;
    }
    .mistake-popup {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: #ff4d4f;
      color: #fff;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s, transform 0.5s;
      z-index: 1000;
      font-size: 1.1rem;
      font-family: inherit;
    }
    .mistake-popup.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Sudoku - Medium</h1>
  <div class="button-row">
    <button class="btn blue" onclick="newGame()"><span>New Game</span></button>
    <button class="btn yellow" onclick="getHint()"><span>&#128161;</span> Hint</button>
    <button class="btn green" onclick="checkBoard()"><span>&#10003;</span> Check</button>
    <button class="btn blue-outline" onclick="goHome()"><span>&#8962;</span> Home</button>
  </div>
  <div id="sudoku-board" class="sudoku-board"></div>
  <div class="number-pad">
    <button onclick="inputNumber(1)">1</button>
    <button onclick="inputNumber(2)">2</button>
    <button onclick="inputNumber(3)">3</button>
    <button onclick="inputNumber(4)">4</button>
    <button onclick="inputNumber(5)">5</button>
    <button onclick="inputNumber(6)">6</button>
    <button onclick="inputNumber(7)">7</button>
    <button onclick="inputNumber(8)">8</button>
    <button onclick="inputNumber(9)">9</button>
    <button onclick="clearCell()">Clear</button>
  </div>
  <div id="mistake-popup" class="mistake-popup">Mistakes: 0</div>
</div>
<script>
// ---- SUDOKU GENERATOR ----

// Helper to shuffle an array
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Check if num can be placed at board[row][col]
function isSafe(board, row, col, num) {
  for (let x = 0; x < 9; x++)
    if (board[row][x] === num || board[x][col] === num)
      return false;
  const startRow = row - row % 3, startCol = col - col % 3;
  for (let i = 0; i < 3; i++)
    for (let j = 0; j < 3; j++)
      if (board[startRow + i][startCol + j] === num)
        return false;
  return true;
}

// Backtracking Sudoku solver (fills the board)
function fillBoard(board) {
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (board[row][col] === 0) {
        let nums = shuffle([1,2,3,4,5,6,7,8,9]);
        for (let num of nums) {
          if (isSafe(board, row, col, num)) {
            board[row][col] = num;
            if (fillBoard(board)) return true;
            board[row][col] = 0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

// Remove cells to create a puzzle of given difficulty
function removeCells(board, clues = 32) {
  let attempts = 81 - clues;
  let puzzle = board.map(row => row.slice());
  while (attempts > 0) {
    let row = Math.floor(Math.random() * 9);
    let col = Math.floor(Math.random() * 9);
    if (puzzle[row][col] !== 0) {
      puzzle[row][col] = 0;
      attempts--;
    }
  }
  return puzzle;
}

// Generate a new Sudoku puzzle and its solution
function generateSudoku(clues = 32) {
  let solution = Array.from({length:9},()=>Array(9).fill(0));
  fillBoard(solution);
  let puzzle = removeCells(solution, clues);
  return { puzzle, solution };
}

// ---- GAME LOGIC ----

let board, originalBoard, solution, selectedCell = null, mistakes = 0;

function newGame() {
  // You can adjust clues for difficulty: easy=40, medium=32, hard=24
  let { puzzle, solution: sol } = generateSudoku(32);
  board = puzzle.map(row => row.slice());
  originalBoard = puzzle.map(row => row.slice());
  solution = sol;
  mistakes = 0;
  selectedCell = null;
  renderBoard();
  showMistakePopup();
}

function renderBoard() {
  const boardDiv = document.getElementById('sudoku-board');
  boardDiv.innerHTML = '';
  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      if ((c + 1) % 3 === 0 && c !== 8) cell.classList.add('box-right');
      if ((r + 1) % 3 === 0 && r !== 8) cell.classList.add('box-bottom');
      if (originalBoard[r][c] !== 0) {
        cell.textContent = originalBoard[r][c];
        cell.classList.add('fixed');
      } else if (board[r][c] !== 0) {
        cell.textContent = board[r][c];
      }
      cell.onclick = () => selectCell(r, c);
      if (selectedCell && selectedCell[0] === r && selectedCell[1] === c) {
        cell.classList.add('selected');
      }
      boardDiv.appendChild(cell);
    }
  }
}

function selectCell(r, c) {
  if (originalBoard[r][c] !== 0) return;
  selectedCell = [r, c];
  renderBoard();
}

function inputNumber(num) {
  if (!selectedCell) return;
  const [r, c] = selectedCell;
  if (!isValidMove(board, r, c, num)) {
    mistakes++;
    showMistakePopup();
    return;
  }
  board[r][c] = num;
  renderBoard();
}

function clearCell() {
  if (!selectedCell) return;
  const [r, c] = selectedCell;
  board[r][c] = 0;
  renderBoard();
}

function isValidMove(board, row, col, num) {
  // Don't check against itself
  for (let i = 0; i < 9; i++) {
    if (i !== col && board[row][i] === num) return false;
    if (i !== row && board[i][col] === num) return false;
  }
  const boxRow = row - row % 3, boxCol = col - col % 3;
  for (let i = 0; i < 3; i++)
    for (let j = 0; j < 3; j++)
      if ((boxRow + i !== row || boxCol + j !== col) && board[boxRow + i][boxCol + j] === num)
        return false;
  return true;
}

function showMistakePopup() {
  const popup = document.getElementById('mistake-popup');
  popup.textContent = `Mistakes: ${mistakes}`;
  popup.classList.add('show');
  setTimeout(() => popup.classList.remove('show'), 1500);
}

function checkBoard() {
  let errors = 0;
  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      if (originalBoard[r][c] === 0 && board[r][c] !== 0) {
        if (board[r][c] !== solution[r][c]) errors++;
      }
    }
  }
  if (errors === 0 && isBoardComplete()) {
    alert("Congratulations! No errors.");
  } else {
    alert(`Total errors: ${errors}`);
  }
}

function isBoardComplete() {
  for (let r = 0; r < 9; r++)
    for (let c = 0; c < 9; c++)
      if (board[r][c] === 0) return false;
  return true;
}

function getHint() {
  // Find all empty cells
  let empties = [];
  for (let r = 0; r < 9; r++)
    for (let c = 0; c < 9; c++)
      if (originalBoard[r][c] === 0 && board[r][c] === 0)
        empties.push([r, c]);
  if (empties.length === 0) return;
  // Pick a random empty cell
  const [r, c] = empties[Math.floor(Math.random() * empties.length)];
  board[r][c] = solution[r][c];
  renderBoard();
}

function goHome() {
  window.location.href = 'difficulty.html';
}

window.onload = newGame;
</script>
</body>
</html>
